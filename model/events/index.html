<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Events - NeuralProphet</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Events";
    var mkdocs_page_input_path = "model/events.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> NeuralProphet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">NeuralProphet</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Quickstart</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../model-overview/">Model Overview</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Model Components</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../trend/">Trend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../seasonality/">Seasonality</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../auto-regression/">Auto-Regression</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../lagged-regressors/">Lagged Regressors</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Events</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#multiplicative-events">Multiplicative Events</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#event-windows">Event Windows</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#country-specific-holidays">Country Specific Holidays</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#regularization-for-events">Regularization for Events</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../future-regressors/">Future Regressors</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contribute/">Contribute</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">NeuralProphet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Model Components &raquo;</li>
        
      
    
    <li>Events</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="modelling-events">Modelling Events</h1>
<p>Often in forecasting problems, we need to consider recurring special events. These are supported
by <code>neural_prophet</code>. These events can be added both in additive format and multiplicative format.</p>
<p>To provide the information of events into the model, the user has to create a dataframe which has the 
column <code>ds</code> corresponding to the event dates and the column <code>event</code> whcih contains
the names of the events on a specified dates. In the following example we have created the
dataframe named <code>history_events_df</code> which contains these events information.</p>
<pre><code class="language-python">playoffs_history = pd.DataFrame({
        'event': 'playoff',
        'ds': pd.to_datetime(['2008-01-13', '2009-01-03', '2010-01-16',
                              '2010-01-24', '2010-02-07', '2011-01-08',
                              '2013-01-12', '2014-01-12', '2014-01-19',
                              '2014-02-02', '2015-01-11', '2016-01-17']),
    })

superbowls_history = pd.DataFrame({
    'event': 'superbowl',
    'ds': pd.to_datetime(['2010-02-07', '2014-02-02']),
    })
history_events_df = pd.concat((playoffs_history, superbowls_history))
</code></pre>
<p>The first few rows of the <code>history_events_df</code> dataframe looks like below. </p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">event</th>
<th align="left">ds</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">playoff</td>
<td align="left">2008-01-13 00:00:00</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">playoff</td>
<td align="left">2009-01-03 00:00:00</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">playoff</td>
<td align="left">2010-01-16 00:00:00</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">playoff</td>
<td align="left">2010-01-24 00:00:00</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">playoff</td>
<td align="left">2010-02-07 00:00:00</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">playoff</td>
<td align="left">2011-01-08 00:00:00</td>
</tr>
</tbody>
</table>
<p>For forecasting, we also need to provide the future dates of these events used to
train the model. You can either include these in the same events dataframe
that was created before for fitting the model, or in a new dataframe as follows. </p>
<pre><code class="language-python">playoffs_future = pd.DataFrame({
    'event': 'playoff',
    'ds': pd.to_datetime(['2016-01-21', '2016-02-07'])
})

superbowl_future = pd.DataFrame({
    'event': 'superbowl',
    'ds': pd.to_datetime(['2016-01-23', '2016-02-07'])
})

future_events_df = pd.concat((playoffs_future, superbowl_future))
</code></pre>
<p>Once the events dataframes have been created, the <code>NeuralProphet</code> object should be created and the
events configs should be added. This is done using the <code>add_events</code> function of the <code>NeuralProphet</code> class.</p>
<pre><code class="language-python">m = NeuralProphet(
        n_forecasts=10,
        yearly_seasonality=False,
        weekly_seasonality=False,
        daily_seasonality=False,
    )
m = m.add_events([&quot;superbowl&quot;, &quot;playoff&quot;])
</code></pre>
<p>After that, we need to convert the events data in the previously created dataframes into the binary input
data expected by the model. This can be done by calling the <code>create_df_with_events</code> function by passing
original time series dataframe along with the created <code>history_events_df</code>.</p>
<pre><code class="language-python">history_df = m.create_df_with_events(df, history_events_df)
</code></pre>
<p>This returns a dataframe in the following format.</p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">ds</th>
<th align="right">y</th>
<th align="right">superbowl</th>
<th align="right">playoff</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">2007-12-10 00:00:00</td>
<td align="right">9.59076</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">2007-12-11 00:00:00</td>
<td align="right">8.51959</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">2007-12-12 00:00:00</td>
<td align="right">8.18368</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">2007-12-13 00:00:00</td>
<td align="right">8.07247</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">2007-12-14 00:00:00</td>
<td align="right">7.89357</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>After that, we can simply fit the model as below.</p>
<pre><code class="language-python">metrics = m.fit(history_df)
</code></pre>
<p>To do forecasting with the fitted model, we first need to create the future dataframe with events
information. This can be done with the <code>make_future_dataframe</code> function by passing in the created
<code>future_events_df</code> and specifying the desired size of the forecast horizon.</p>
<pre><code class="language-python">future = m.make_future_dataframe(df=history_df, events_df=future_events_df, future_periods=10)
forecast = m.predict(df=future)
</code></pre>
<p>The produced forecasts look like below. The 10 step-ahead forecasts are available in the <code>yhat1</code> column.
The components from the individual events are available in the <code>event_playoff</code> and <code>event_superbowl</code> columns and 
their agrgegated effect is shown on the <code>events_additive</code> column.</p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">ds</th>
<th align="left">y</th>
<th align="right">yhat1</th>
<th align="right">residual1</th>
<th align="right">trend</th>
<th align="right">events_additive</th>
<th align="right">event_playoff</th>
<th align="right">event_superbowl</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">2016-01-21 00:00:00</td>
<td align="left"></td>
<td align="right">7.34693</td>
<td align="right">nan</td>
<td align="right">-0.583201</td>
<td align="right">-0.208826</td>
<td align="right">-0.208826</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">2016-01-22 00:00:00</td>
<td align="left"></td>
<td align="right">7.55506</td>
<td align="right">nan</td>
<td align="right">-0.5839</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">2016-01-23 00:00:00</td>
<td align="left"></td>
<td align="right">6.95665</td>
<td align="right">nan</td>
<td align="right">-0.584599</td>
<td align="right">-0.597706</td>
<td align="right">0</td>
<td align="right">-0.597706</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">2016-01-24 00:00:00</td>
<td align="left"></td>
<td align="right">7.55366</td>
<td align="right">nan</td>
<td align="right">-0.585297</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">2016-01-25 00:00:00</td>
<td align="left"></td>
<td align="right">7.55296</td>
<td align="right">nan</td>
<td align="right">-0.585997</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">2016-01-26 00:00:00</td>
<td align="left"></td>
<td align="right">7.55226</td>
<td align="right">nan</td>
<td align="right">-0.586695</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">6</td>
<td align="left">2016-01-27 00:00:00</td>
<td align="left"></td>
<td align="right">7.55156</td>
<td align="right">nan</td>
<td align="right">-0.587394</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">7</td>
<td align="left">2016-01-28 00:00:00</td>
<td align="left"></td>
<td align="right">7.55087</td>
<td align="right">nan</td>
<td align="right">-0.588093</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">8</td>
<td align="left">2016-01-29 00:00:00</td>
<td align="left"></td>
<td align="right">7.55017</td>
<td align="right">nan</td>
<td align="right">-0.588792</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="right">9</td>
<td align="left">2016-01-30 00:00:00</td>
<td align="left"></td>
<td align="right">7.54947</td>
<td align="right">nan</td>
<td align="right">-0.58949</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The different components can be plotted like below. All events are plotted as one component,
the <code>Additive Events</code></p>
<pre><code class="language-python">fig_comp = m.plot_components(forecast)
</code></pre>
<p><img alt="plot-comp-1" src="./images/plot_comp_events_1.png" /></p>
<p>If you want to have a look at the coefficients of the events, the <code>plot_parameters</code> function is helpful.</p>
<pre><code class="language-python">fig_param = m.plot_parameters()
</code></pre>
<p><img alt="plot-param-1" src="../../images/plot_param_events_1.png" /></p>
<h2 id="multiplicative-events">Multiplicative Events</h2>
<p>The default mode for events in <code>neural_prophet</code> is additive. However, events can also be modelled
in a multiplicative format. For this, when adding the events configs to the <code>NeuralProphet</code> object,
we need to set the <code>mode</code> to <code>multiplicative</code> as below.</p>
<pre><code class="language-python">m = m.add_events([&quot;superbowl&quot;, &quot;playoff&quot;], mode=&quot;multiplicative&quot;)
</code></pre>
<p>All the other steps are the same as for the <code>additive</code> mode. Now, when you plot the components,
the event components will appear as percentages.</p>
<p><img alt="plot-comp-2" src="../../images/plot_comp_events_2.png" /></p>
<p>In the same manner, the coefficients too, will now appear as percentages when plotted.</p>
<p><img alt="plot-param-2" src="../../images/plot_param_events_2.png" /></p>
<h2 id="event-windows">Event Windows</h2>
<p>You can also provide windows for events. This way, you can consider the days around a 
particular event also as special events by providing the arguments <code>lower_window</code> and 
<code>upper_window</code> as appropriate to the <code>add_events</code> function of the <code>NeuralProphet</code> object.
By default, the values for these windows are <code>0</code>, which means windows are not considered.</p>
<pre><code class="language-python">m = m.add_events([&quot;superbowl&quot;, &quot;playoff&quot;], lower_window=-1, upper_window=1)
</code></pre>
<p>According to this specification, for both <code>superbowl</code> and <code>playoff</code> events, three special events will be 
modelled, the event date, the previous day and the next day. These will be visible in the component plots as below.</p>
<p><img alt="plot-comp-3" src="../../images/plot_comp_events_3.png" /></p>
<p>In the parameters plot too, there will now be <code>superbowl_+1</code> and <code>superbowl_-1</code> which correspond to the coefficients of the
day following and previous to the <code>superbowl</code> event. The <code>playoff</code> event also has the same new coefficients.</p>
<p><img alt="plot-param-3" src="../../images/plot_param_events_3.png" /></p>
<p>If you want to define different windows for the individual events, this can also be done as follows.</p>
<pre><code class="language-python">m = m.add_events(&quot;superbowl&quot;, lower_window=-1, upper_window=1)
m = m.add_events(&quot;playoff&quot;, upper_window=2)
</code></pre>
<p>In the above example, for the <code>playoff</code> event, the specified event date, as well as the two following dates
are considered as three different special events.</p>
<h2 id="country-specific-holidays">Country Specific Holidays</h2>
<p>Apart from the user specified events, <code>neural_prophet</code> also supports standard country specific holidays.
If you want to add the holidays for a particualr country, you simply have to call the <code>add_country_holidays</code>
function on the <code>NeuralProphet</code> object and specify the country. Similar to the user specified events,
country specific holidays can either be <code>additive</code> or <code>multiplicative</code> and include windows. However,
unlike for user specified events, the windows will be the same for all the country specific events. </p>
<pre><code class="language-python">m = m.add_country_holidays(&quot;US&quot;, mode=&quot;additive&quot;, lower_window=-1, upper_window=1)
</code></pre>
<p>This example will add all the <code>US</code> holidays into the model in <code>additive</code> format. The coefficients of the
individual events will now look like below.</p>
<p><img alt="plot-param-3" src="../../images/plot_param_events_4.png" /></p>
<h2 id="regularization-for-events">Regularization for Events</h2>
<p>Events can also support regularization of the coefficients. You can specify the regularization
when adding the event configs into the <code>NeuralProphet</code> object like below.</p>
<pre><code class="language-python">m = m.add_events([&quot;superbowl&quot;, &quot;playoff&quot;], regularization=0.05)
</code></pre>
<p>The regularization for the individual events can also be different from each other like below.</p>
<pre><code class="language-python">m = m.add_events(&quot;superbowl&quot;, regularization=0.05)
m = m.add_events(&quot;playoff&quot;, regularization=0.03)
</code></pre>
<p>For the country specific holidays too, regularizations can be specified like below.</p>
<pre><code class="language-python">m = m.add_country_holidays(&quot;US&quot;, mode=&quot;additive&quot;, regularization=0.05)
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../future-regressors/" class="btn btn-neutral float-right" title="Future Regressors">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../lagged-regressors/" class="btn btn-neutral" title="Lagged Regressors"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../lagged-regressors/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../future-regressors/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
