<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Auto-Regression - NeuralProphet</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Auto-Regression";
    var mkdocs_page_input_path = "model/auto-regression.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> NeuralProphet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">NeuralProphet</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../model-overview/">Model Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../changes-from-prophet/">Changes from Prophet</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Quickstart</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Model Components</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../trend/">Trend</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../seasonality/">Seasonality</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Auto-Regression</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#regularize-ar-net">Regularize AR-Net</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#highlight-specific-forecast-step">Highlight Specific Forecast Step</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../lagged-regressors/">Lagged Regressors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../events/">Events</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../future-regressors/">Future Regressors</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Model Parameters</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../hyperparameter-selection/">Hyperparameter Selection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contribute/">Contribute</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">NeuralProphet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Model Components &raquo;</li>
        
      
    
    <li>Auto-Regression</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="modelling-auto-regression">Modelling Auto-Regression</h1>
<p>AR-Net can be enabled in the NeuralProphet by simply setting an appropriate value to the
<code>n_lags</code> parameter of the <code>NeuralProphet</code> object.</p>
<pre><code class="language-python">m = NeuralProphet(
    n_forecasts=3,
    n_lags=5,
    yearly_seasonality=False,
    weekly_seasonality=False,
    daily_seasonality=False,
)
</code></pre>
<p>In the above example, we create a forecasting scenario which feeds 5 lags into AR-Net and receives
3 steps as forecasts. Once you have the AR-Net enabled, during forecasting your <code>future_periods</code> value
should be equal to the <code>n_forecasts</code> value specified when creating the <code>NeuralProphet</code> object. Whichever
value you specify for <code>future_periods</code>, it will be converted to the value of <code>n_forecasts</code> with a notice
to the user. This is because, since the AR-Net is built during training such that it has an ouptut size
of <code>n_forecasts</code>, it cannot support any other value during testing.</p>
<p>The plotted components should look like below.</p>
<p><img alt="plot-comp-1" src="../../images/plot_comp_ar_1.png" style="height:600px" /></p>
<p>You can now see auto-regression as a separate component. The corresponding coefficients look like
below.</p>
<p><img alt="plot-param-1" src="../../images/plot_param_ar_1.png" style="height:600px" /></p>
<p>You can see the relevance of each of the lags when modelling the autocorrelation. You can also specify the <code>num_hidden_layers</code> 
for the AR-Net, in order to increase the complexity of the AR-Net.</p>
<pre><code class="language-python">m = NeuralProphet(
    n_forecasts=3,
    n_lags=5,
    num_hidden_layers=2,
    yearly_seasonality=False,
    weekly_seasonality=False,
    daily_seasonality=False
)
</code></pre>
<h2 id="regularize-ar-net">Regularize AR-Net</h2>
<p>Regularization in AR-Net is done by setting the <code>ar_sparsity</code> parameter in the <code>NeuralProphet</code> object
like below. For more details on setting a value for <code>ar_sparsity</code>, refer to the Section on 
<a href="../../hyperparameter-selection/#regularization-related-parameters">Hyperparameter Selection</a>. </p>
<pre><code class="language-python">m = NeuralProphet(
    n_forecasts=3,
    n_lags=5,
    num_hidden_layers=2,
    ar_sparsity=0.01,
    yearly_seasonality=False,
    weekly_seasonality=False,
    daily_seasonality=False
)
</code></pre>
<h2 id="highlight-specific-forecast-step">Highlight Specific Forecast Step</h2>
<p>When modelling the autocorrelation, the model in the multi-input, multi-output mode. In this mode, you can highlight the nth step
ahead forecast. This means that, you can specifically look at the forecast at the nth step when calculating errors during model training
as well as when forecast plotting. This can be done like below.</p>
<pre><code class="language-python">m = NeuralProphet(
    n_forecasts=30,
    n_lags=60,
    yearly_seasonality=False,
    weekly_seasonality=False,
    daily_seasonality=False
)
m.highlight_nth_step_ahead_of_each_forecast(step_number=m.n_forecasts)
</code></pre>
<p>You can specify any value less than or equal to <code>n_forecasts</code> to the <code>step_number</code> parameter.
Once you do this, the metrics would look like below.</p>
<table>
<thead>
<tr>
<th align="left">SmoothL1Loss</th>
<th align="center">MAE</th>
<th align="center">SmoothL1Loss-3</th>
<th align="center">MAE-3</th>
<th align="right">RegLoss</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0.272427</td>
<td align="center">3.063127</td>
<td align="center">0.164296</td>
<td align="center">2.407697</td>
<td align="right">0.0</td>
</tr>
<tr>
<td align="left">0.151259</td>
<td align="center">2.303768</td>
<td align="center">0.144811</td>
<td align="center">2.261525</td>
<td align="right">0.0</td>
</tr>
<tr>
<td align="left">0.129990</td>
<td align="center">2.140769</td>
<td align="center">0.127703</td>
<td align="center">2.126293</td>
<td align="right">0.0</td>
</tr>
<tr>
<td align="left">0.116178</td>
<td align="center">2.020397</td>
<td align="center">0.113719</td>
<td align="center">2.005068</td>
<td align="right">0.0</td>
</tr>
<tr>
<td align="left">0.104502</td>
<td align="center">1.915078</td>
<td align="center">0.101155</td>
<td align="center">1.887193</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>In the forecast plots, it will focus only on the nth step ahead forecast. This is shown below for the fir of the model. </p>
<p><img alt="plot-forecast-1" src="../../images/plot_forecast_ar_1.png" style="height:400px" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../lagged-regressors/" class="btn btn-neutral float-right" title="Lagged Regressors">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../seasonality/" class="btn btn-neutral" title="Seasonality"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../seasonality/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../lagged-regressors/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
